<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SL Courier-admin</title>
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <header>
        <nav class='nav-bar'>
            <ul>
                <li class='logo'><img src="../images/logo.png" alt="">SL Courier</li>
                <li><a href="index.html">Package Routing</a></li>
                <li><a href="manage_driver.html">Manage Drivers</a></li>
                <li><a href="manage_package.html">Manage Packages</a></li>
                <li><a href="manage_payments.html">Manage Payments</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div class="container">
            <header>
                <h1>Manage Packages</h1>
            </header>
            <section id="pickupList">
                <div class="description">
                    <form action="/submit-package" method="POST">
                        <div id="manage_package_Pid">
                            <label for="r_package"><span>Package ID</span></label>
                            <select class="field_effect" id="r_package" name="packageID">
                                <option value="">Select a package</option>
                            </select>
                        </div><br><br>

                        <div id="manage_package_Daddress">
                            <label for="mP_Daddress"><span>Delivery Address</span></label>
                            <input type="text" class="field_effect" id="mP_Daddress" required>
                        </div>

                        <div id="manage_package_Paddress">
                            <label for="mP_Paddress"><span>Pickup Address</span></label>
                            <input type="text" class="field_effect" id="mP_Paddress" required readonly>
                        </div><br><br>

                        <div id="manage_package_Ddate">
                            <label for="mP_Ddate"><span>Delivery Date</span></label>
                            <input type="date" class="field_effect" id="mP_Ddate" name="deliveryDate" name="deliveryDate" required>
                        </div>

                        <div id="manage_package_Dtime">
                            <label for="mP_Dtime"><span>Delivery Time</span></label>
                            <input type="time" class="field_effect" id="mP_Dtime" name="deliveryTime" required min="09:00" max="20:00">
                        </div><br><br>

                        <div id="routing_reset">
                            <input class="button" type="reset">
                        </div>

                        <div id="routing_submit">
                            <input class="button" type="submit">
                        </div>
                    </form>
                </div>
            </section><br>
        </div>
    </main>

    <footer>
        <span>2024 Â© StreamLine Courier Services Pvt. Limited. All rights reserved</span>
        <a href="#">Privacy Policy</a>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const packageSelect = document.getElementById('r_package');
            const pickupAddress = document.getElementById('mP_Paddress');
            const deliveryAddress = document.getElementById('mP_Daddress');
            const packageForm = document.getElementById('package-form');

            // Fetch all packages and populate package select dropdown
            fetch('/packages')
                .then(response => response.json())
                .then(data => {
                    data.forEach(pkg => {
                        const option = document.createElement('option');
                        option.value = pkg.packageID;
                        option.textContent = pkg.packageID;
                        packageSelect.appendChild(option);
                    });
                });

            //fetch package details when a package is selected
            packageSelect.addEventListener('change', () => {
                const packageID = packageSelect.value;
                if (packageID) {
                    fetch(`/package/${packageID}`)
                        .then(response => response.json())
                        .then(data => {
                            pickupAddress.value = data.pickup_address;
                            deliveryAddress.value = data.delivery_address;
                        });
                } else {
                    pickupAddress.value = '';
                    deliveryAddress.value = '';
                }
            });

            // Validate delivery date
            deliveryDateInput.addEventListener('change', (event) => {
                const selectedDate = new Date(event.target.value);
                const today = new Date();
                today.setHours(0, 0, 0, 0); // Set to midnight to only compare date part
                const day = selectedDate.getDay(); // 0: Sunday, 1: Monday, ..., 6: Saturday

                if (selectedDate < today) {
                    alert('Past dates are not allowed. Please select today or an upcoming date.');
                    event.target.value = '';
                } else if (day === 0) {
                    alert('Delivery date cannot be Sunday. Please select a date from Monday to Saturday.');
                    event.target.value = '';
                }
            });
            
            //handle form submission
            packageForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const packageID = packageSelect.value;
                const deliveryAddressValue = deliveryAddress.value;
                const deliveryDateValue = document.getElementById('mP_Ddate').value;
                const deliveryTimeValue = document.getElementById('mP_Dtime').value;

                fetch('/update-package', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        packageID,
                        delivery_address: deliveryAddressValue,
                        delivery_date: deliveryDateValue,
                        delivery_time: deliveryTimeValue,
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Package updated successfully');
                    } else {
                        alert('Failed to update package');
                    }
                });
            });
        });
    </script>
</body>
</html> -->



<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SL Courier-admin</title>
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <header>
        <nav class='nav-bar'>
            <ul>
                <li class='logo'><img src="../images/logo.png" alt="">SL Courier</li>
                <li><a href="index.html">Package Routing</a></li>
                <li><a href="manage_driver.html">Manage Drivers</a></li>
                <li><a href="manage_package.html">Manage Packages</a></li>
                <li><a href="manage_payments.html">Manage Payments</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div class="container">
            <header>
                <h1>Manage Packages</h1>
            </header>
            <section id="pickupList">
                <div class="description">
                    <form id="package-form" action="/submit-package" method="POST">
                        <div id="manage_package_Pid">
                            <label for="r_package"><span>Package ID</span></label>
                            <select class="field_effect" id="r_package" name="packageID">
                                    <option value="">Select a package</option>
                            </select>
                        </div><br><br>

                        <div id="manage_package_Daddress">
                            <label for="mP_Daddress"><span>Delivery Address</span></label>
                            <input type="text" class="field_effect" id="mP_Daddress" name="deliveryAddress" required>
                        </div>

                        <div id="manage_package_Paddress">
                            <label for="mP_Paddress"><span>Pickup Address</span></label>
                            <input type="text" class="field_effect" id="mP_Paddress" required readonly>
                        </div><br><br>

                        <div id="manage_package_Ddate">
                            <label for="mP_Ddate"><span>Delivery Date</span></label>
                            <input type="date" class="field_effect" id="mP_Ddate" name="deliveryDate" required>
                        </div>

                        <div id="manage_package_Dtime">
                            <label for="mP_Dtime"><span>Delivery Time</span></label>
                            <input type="time" class="field_effect" id="mP_Dtime" name="deliveryTime" required min="09:00" max="20:00">
                        </div><br><br>

                        <div id="routing_reset">
                            <input class="button" type="reset">
                        </div>

                        <div id="routing_submit">
                            <input class="button" type="submit">
                        </div>
                    </form>
                </div>
            </section><br>
        </div>
    </main>

    <footer>
        <span>2024 Â© StreamLine Courier Services Pvt. Limited. All rights reserved</span>
        <a href="#">Privacy Policy</a>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const packageSelect = document.getElementById('r_package');
            const pickupAddress = document.getElementById('mP_Paddress');
            const deliveryAddress = document.getElementById('mP_Daddress');
            const deliveryDateInput = document.getElementById('mP_Ddate');
            const packageForm = document.getElementById('package-form');

            // Fetch all packages and populate package select dropdown
            fetch('/packages')
                .then(response => response.json())
                .then(data => {
                    data.forEach(pkg => {
                        const option = document.createElement('option');
                        option.value = pkg.packageID;
                        option.textContent = pkg.packageID;
                        packageSelect.appendChild(option);
                    });
                });

            // Fetch package details when a package is selected
            packageSelect.addEventListener('change', () => {
                const packageID = packageSelect.value;
                if (packageID) {
                    fetch(`/package/${packageID}`)
                        .then(response => response.json())
                        .then(data => {
                            pickupAddress.value = data.pickup_address;
                            deliveryAddress.value = data.delivery_address;
                        });
                } else {
                    pickupAddress.value = '';
                    deliveryAddress.value = '';
                }
            });

            // Validate delivery date
            deliveryDateInput.addEventListener('change', (event) => {
                const selectedDate = new Date(event.target.value);
                const today = new Date();
                today.setHours(0, 0, 0, 0); // Set to midnight to only compare date part
                const day = selectedDate.getDay(); // 0: Sunday, 1: Monday, ..., 6: Saturday

                if (selectedDate < today) {
                    alert('Past dates are not allowed. Please select today or an upcoming date.');
                    event.target.value = '';
                } else if (day === 0) {
                    alert('Delivery date cannot be Sunday. Please select a date from Monday to Saturday.');
                    event.target.value = '';
                }
            });

            // Handle form submission
            packageForm.addEventListener('submit', (e) => {
                const deliveryDateValue = document.getElementById('mP_Ddate').value;
                const selectedDate = new Date(deliveryDateValue);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const day = selectedDate.getDay();

                if (selectedDate < today || day === 0) {
                    e.preventDefault();
                    if (selectedDate < today) {
                        alert('Past dates are not allowed. Please select today or an upcoming date.');
                    } else if (day === 0) {
                        alert('Delivery date cannot be Sunday. Please select a date from Monday to Saturday.');
                    }
                } else {
                    // If validation passes, allow form submission
                    const packageID = packageSelect.value;
                    const deliveryAddressValue = deliveryAddress.value;
                    const deliveryTimeValue = document.getElementById('mP_Dtime').value;

                    fetch('/update-package', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            packageID,
                            delivery_address: deliveryAddressValue,
                            delivery_date: deliveryDateValue,
                            delivery_time: deliveryTimeValue,
                        }),
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('Package updated successfully');
                        } else {
                            alert('Failed to update package');
                        }
                    });
                }
            });
        });
    </script>
</body>
</html>
